// Add the dialog title
$('#dialog h4').html("<i class='fa fa-plus'></i>&nbsp; Reservar Consola");


// Render the new form
$('.modal-body').html('<%= j render("form") %>');

// Show the dynamic dialog
$('#dialog').modal("show");

// Set focus to the first element
$('#dialog').on('shown.bs.modal', function () {
	  $('.first_input').focus()
});

$('.input-group.date').datepicker({
	autoclose: true,
	orientation: "bottom auto",
	format: "yyyy-mm-dd"
});

Cargar_En_Reserva();
function Cargar_En_Reserva(){
  var muestraReloj;
  muestraReloj = function() {
    var fechaHora, horas, minutos, segundos;
    fechaHora = new Date;
    horas = fechaHora.getHours();
    minutos = fechaHora.getMinutes();
    segundos = fechaHora.getSeconds();
    sufijo = ' AM';
    // if (horas > 12) {
    //   horas = horas - 12;
    //   sufijo = ' PM';
    // }
    if (horas < 10) {
      horas = '0' + horas;
    }
    if (minutos < 10) {
      minutos = '0' + minutos;
    }
    if (segundos < 10) {
      segundos = '0' + segundos;
    }
    $('#reservation_start_time').val(horas + ':' + minutos);
  };



  setTimeout(muestraReloj, 1);
  window.onload = function() {
    setInterval(muestraReloj, 60000);
  };

  $('#reservation_reserve_price_id').change(function() {
    var fechaHora, fin, h_split, h_split_f, horas, inter, minutos, rel_fin, second_split, seconds, segundos, send_ini, split_time, split_time_f, sufijo, sum_rel_fin, var_start_time, var_id_interval;
    fechaHora = new Date;
    horas = fechaHora.getHours();
    minutos = fechaHora.getMinutes();
    segundos = fechaHora.getSeconds();

    var id_reserve_price = $('#reservation_reserve_price_id option:selected').val();

    $.ajax({
      url:'/reservations/price_interval',
      data:{id_reserve_price_selected:id_reserve_price},
      type:'get',
      DataType:'json'
    }).done(function(done){

      var price = done['value'];
      $('.field_prices').val(price);
      $('.field_prices_id').val(id_reserve_price);


    }).error(function(errors){
      alert(errors);
    });


    // if (horas > 12) {
    //   horas = horas - 12;
    //   sufijo = ' PM';
    // }
    if (horas < 10) {
      horas = '0' + horas;
    }
    if (minutos < 10) {
      minutos = '0' + minutos;
    }
    if (segundos < 10) {
      segundos = '0' + segundos;
    }
    inter = parseInt($('#reservation_reserve_price_id option:selected').text());
    var_start_time = $('#reservation_start_time').val();
    if (var_start_time !== '') {
      split_time = var_start_time.split(':');
      second_split = split_time[1];
      split_time_f = second_split.split(' ');
      rel_fin = parseInt(split_time_f[0]);
      sum_rel_fin = rel_fin + inter;
      if (sum_rel_fin >= '60') {
        h_split = parseInt(split_time[0]);
        h_split_f = h_split + 1;
        fin = sum_rel_fin - 60;
        send_ini = parseInt('00');
        seconds = send_ini + fin;
        if (seconds < 10) {
          seconds = '0' + seconds;
        }
        $('#reservation_end_time').val(h_split_f + ':' + seconds);
      } else {
        h_split = parseInt(split_time[0]);
        // h_split_f = h_split + 1;
        if (h_split < 10) {
          h_split = '0' + h_split;
        }
        seconds = sum_rel_fin;
        $('#reservation_end_time').val(h_split + ':' + seconds);
      }
    }
  });
}


